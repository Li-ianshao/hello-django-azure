{% load custom_filters %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Stock Table</title>
  <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 30px;
        background-color: #f5f7fa;
    }
    
    button {
        padding: 10px 30px;
        background-color: #007acc;
        color: white;
        border: none;
        border-radius: 5px;
    }

    /* 條件式樣式 */
    .rsi-high {
        background-color: #ffd6d6 !important;  /* 淡紅色 */
        color: #a80000;
        font-weight: bold;
    }

    .rsi-low {
        background-color: #d6ecff !important;  /* 淡藍色 */
        color: #004f9e;
        font-weight: bold;
    }

    .no-dividend {
        background-color: #eeeeee !important;
        color: #999;
    }

    .high-volume {
        background-color: #e2f7e2 !important;  /* 淡綠色 */
        font-weight: bold;
    }

    /* 基本樣式 */

    h2 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    th, td {
        border: 1px solid #ddd;
        padding: 12px 16px;
        text-align: center;
    }

    th {
        background-color: #007acc;
        color: white;
        font-weight: bold;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:hover {
        background-color: #e8f4fd;
    }

  </style>
</head>
<body>
  <form action="{% url 'logout' %}" method="post">
      {% csrf_token %}
      <button type="submit">登出</button>
  </form>
  <h2 style="text-align: center;">📈 Stock Overview</h2>
  <table>
    <thead>
      <tr>
        <th>代碼</th>
        <th>收盤價</th>
        <th>配息日</th>
        <th>配息</th>
        <th>此次配息率</th>
        <th>殖利率</th>
        <th>當日漲跌幅</th>
        <th>一年最低價</th>
        <th>一年最高價</th>
        <th>RSI</th>
        <th>volume_Delta</th>
      </tr>
    </thead>
    <tbody>
      {% for s in stocks %}
      <tr>
          <td>{{ s.symbol }}</td>
          

          <td>{{ s.close|dollar_or_na }}</td>

          <td title="{% if s.dividend_date == 'N/A' %}無可用配息日資料{% else %}配息日 (ex-dividend date){% endif %}">
              {{ s.ex_dividend_date }}
          </td>

          <td title="{% if not s.dividend or s.dividend == 0 or s.dividend == 'N/A' %}此股票不配息{% else %}配息中{% endif %}"
              class="{% if not s.dividend or s.dividend == 0 %}no-dividend{% endif %}">
              {{ s.dividend|dollar_or_na }}
          </td>

          <td title="{% if not s.dividend_ratio or s.dividend_ratio == 0 or s.dividend_ratio == 'N/A' %}此股票不配息{% else %}配息中{% endif %}"
              class="{% if not s.dividend_ratio or s.dividend_ratio == 0 %}no-dividend{% endif %}">
              {{ s.dividend_ratio|percent_or_na }}
          </td>

          <td title="{% if not s.yield or s.yield == 0 or s.yield == 'N/A' %}此股票不配息{% else %}配息中{% endif %}"
              class="{% if not s.yield or s.yield == 0 %}no-dividend{% endif %}">
              {{ s.yield|percent_or_na }}
          </td>

          <td title="{% if s.price_change > 10 %}變動福大{% else %}正常波動{% endif %}"
              class="{% if s.price_change|default:0 > 10 %}high-volume{% endif %}">
              {{ s.price_change|percent_or_na }}
          </td>

          <td>
              {{ s.year_low }}
          </td>

          <td>
              {{ s.year_high }}
          </td>

          <td title="{% if s.rsi != 'N/A' %}
                      {% if s.rsi > 70 %}
                          RSI 過熱 (>70)
                      {% elif s.rsi < 30 %}
                          RSI 超跌 (<30)
                      {% else %}
                          RSI 正常範圍
                      {% endif %}
                    {% else %}
                        無 RSI 資料
                    {% endif %}"
              class="
                  {% if s.rsi != 'N/A' %}
                      {% if s.rsi > 70 %}
                          rsi-high
                      {% elif s.rsi < 30 %}
                          rsi-low
                      {% endif %}
                  {% endif %}
              ">
              {{ s.rsi }}
          </td>

          <td title="{% if s.volume_delta > 100 %}高成交量{% else %}正常成交量{% endif %}"
              class="{% if s.volume_delta|default:0 > 100 %}high-volume{% endif %}">
              {{ s.volume_delta|percent_or_na }}
          </td>
          
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
